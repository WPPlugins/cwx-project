/**
 * @package CWX Project
 */

/*
Simple Project Management and TODO-List application for Wordpress Blogs.
Copyright (C) 2014 Chrome Runner

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>.
*/


!function(t){var e={init:function(i){var n={},o=t.extend(!0,{},n,i);return this.each(function(){var i=t(this).parent(),n=t(this),a=(t(".cwx-tab-strip",t(this)),t(".cwx-tab-sheet",t(this)));t(this).cwxTabbedControl(),i.data({isDirty:!1}),t("#cwx-filters-toggle").remove(),t("input[type=text].cwx-color-control",a).cwxColorControl(o),t("input[type=text][list]",i).cwxMetaListControl(),t("input[type=submit].button",i).prop("disabled",!0),t(".cwx-project-actions-settings a.button").text(cwxProjectL10n.buttonClose),t(".cwx-project-new-item input[type=button]",n).prop("disabled",!0),i.on("submit",function(i){var n=this;i.preventDefault(),t.post(ajaxurl,t(this).serialize(),function(i){if(i.error){var o="";o=t.isArray(i.error)?i.error.join("<br />"):i.error,t(".cwx-error",t(n)).html(o)}i.result&&(i.result.meta&&t.each(i.result.meta,function(i,o){var a=t("tr#cwx-project-meta-"+i,t(n)),c=e.getSheet(a);o.deleted?(s.uiRemove(c.data("list-id"),o.title),a.remove()):(t('input[name="cwx_meta_title['+i+']"]',a).val(o.title),o.moved&&t('input[name="cwx_meta_moveto['+i+']"]',a).val(""),o.accepted&&t(".cwx-project-meta-proposal",a).html(""),o.created&&e.uiAddMeta({meta_id:o.created.id,title:o.created.title},c))}),i.result.priorities&&t.each(i.result.priorities,function(e,i){t("input#cwx-priority-"+e,t(n)).val(i)}),t(n).data({isDirty:!1}),t("input[type=submit].button",t(n)).prop("disabled",!0),t(".cwx-project-actions-settings .cwx-cancel").text(cwxProjectL10n.buttonClose))},"json")}),t(".cwx-project-new-item input[type=button]",n).on("click",function(){var i=this,n=e.getSheet(t(this)),o=t(this).parent().find("input[type=text]"),a=t("input[name=_meta_nonce]",t(this.form)).val(),c=n.data("meta-type");s.add(o.val(),c,a,function(a){a.error&&t(".cwx-error",t(i.form)).html(a.error).show(),a.status&&(o.val(""),t(i).prop("disabled",!0),n.find(".cwx-no-entries").hide(),e.uiAddMeta(a,n))})}),t(".cwx-project-new-item input[type=text]",n).on("change input keydown",function(e){var n=t(this).next();if("keydown"===e.type){if(e.ctrlKey&&e.shiftKey&&(37==e.which||39==e.which))return 37==e.which?t(".cwx-tab-scroll-left",i).trigger("click"):39==e.which&&t(".cwx-tab-scroll-right",i).trigger("click"),void e.stopPropagation();if(13===e.which&&!n.prop("disabled"))return void n.trigger("click")}e.stopImmediatePropagation(),t(this).val()?n.prop("disabled",!1):n.prop("disabled",!0)}),t(".cwx-role-name-item",n).on("click keydown",function(e){("keydown"!=e.type||13==e.which)&&(t(".cwx-role-name-item",n).removeClass("cwx-item-active"),t(".cwx-list-capabilities",n).removeClass("cwx-list-active"),t(this).addClass("cwx-item-active"),t("#"+this.id.replace(/\-item/,"-list")).addClass("cwx-list-active").find(":input:first").get(0).focus())}),t("a.cwx-cancel",i).on("click",function(){i.data({isDirty:!1})}),i.on("change input",":input",function(){t(this.form).data({isDirty:!0}),t("input[type=submit].button",i).prop("disabled",!1),t(".cwx-project-actions-settings a.button").text(cwxProjectL10n.buttonCancel)}),i.on("keydown",":input, a",function(e){e.ctrlKey&&e.shiftKey&&(37==e.which||39==e.which)&&(37==e.which?t(".cwx-tab-scroll-left",i).trigger("click"):39==e.which&&t(".cwx-tab-scroll-right",i).trigger("click"))}),t("#cwx-config-sheet-permissions").on("keydown",function(e){if(e.altKey&&(33==e.which||34==e.which)){var i=t(".cwx-role-names",t(this)),n=t(".cwx-item-active",i);34==e.which?n.next().trigger("click"):33==e.which&&n.prev().trigger("click")}}),t(window).on("beforeunload",function(){return i.data("is-dirty")?cwxProjectL10n.confirmUnsaved:void 0})})},uiAddMeta:function(i,n){var o=e.getSheet(n),a=t("table.cwx-project-meta-list",o),c=t("#cwx-project-meta-template > table tr").clone();o.length&&a.length&&(c.prop("id",c.prop("id").replace(/\%id/,parseInt(i.meta_id))),c.html(c.html().replace(/\%id/g,parseInt(i.meta_id))),t("tbody",a).append(c),t("input[name^=cwx_meta_type]",c).val(o.data("meta-type")),t("input[name^=cwx_meta_title]",c).val(i.title),t("input[name^=cwx_meta_moveto]",c).attr("list",o.data("list-id")).cwxMetaListControl(),s.uiAdd(o.data("list-id"),i.title))},getMetaType:function(t){return e.getSheet(t).data("meta-type")},getMetaList:function(t){return e.getSheet(t).data("list-id")},getSheet:function(t){return t.closest(".cwx-tab-sheet")}},i={isReady:!1,isAction:!1,init:function(e){{var n={};t.extend(!0,{},n,e)}return this.each(function(){var e=t(this),n=t("#cwx-trashcan",e),o=t("#cwx-trash-list",e);$form=t("#cwx_project_dashwidget .dashboard-widget-control-form"),t("#cwx_project_dashwidget p.submit").remove(),t("input[type=submit].button",$form).prop("disabled",!0),t("#cwx-trash-list-wrap").hide(),t(".cwx-loading",n).slideDown(function(){var e=this;i.loadList(this.id,function(i){t(e).slideUp(),"message::empty"!=i&&(o.html(i),t("#cwx-trash-list-wrap").slideDown("slow")),t("tr",o).length||t(".cwx-no-entries").slideDown()})}),o.on("click","tr",function(){t("input[type=checkbox]",t(this)).trigger("change")}),o.on("change","input[type=checkbox]",function(){t(this).prop("checked",!t(this).prop("checked")),i.isReady=t(this.form).find("input[type=checkbox]:checked").length?!0:!1,t("input[type=submit].button",$form).prop("disabled",!(i.isReady&&i.isAction))}),t("select[name=bulk_action]").on("change",function(){i.isAction=0!=this.selectedIndex?!0:!1,t("input[type=submit].button",$form).prop("disabled",!(i.isReady&&i.isAction))}),$form.on("submit",function(e){e.preventDefault(),i.isReady&&i.isAction&&t(".cwx-loading",n).slideDown(function(){var e=this;t.post(ajaxurl,$form.serialize(),function(i){t(e).slideUp(),"delete"==i.action?t.each(i.projects,function(e){t("#cwx-project-id-"+e).fadeOut("slow",function(){t(this).remove()})}):"restore"==i.action&&t.each(i.projects,function(e){t('input[name^="sel_task['+e+']"]').length?t("#cwx-project-id-"+e+" input[name^=sel_project]").fadeOut("slow",function(){t(this).remove()}):t("#cwx-project-id-"+e).fadeOut("slow",function(){t(this).remove()})}),t.each(i.more,function(e){t('input[name^="sel_task['+e+']"]').closest("tr").fadeOut("slow",function(){t(this).remove()})}),t.each(i.tasks,function(e){t('input[name^=sel_task][value="'+e+'"]').closest("tr").fadeOut("slow",function(){t(this).remove()})}),setTimeout(function(){t(".cwx-trashrow-project").each(function(){var e=this.id.replace(/cwx\-project\-id\-/,"");t("input[type=checkbox]",t(this)).length||t('input[name^="sel_task['+e+']"]').length||t(this).fadeOut("slow",function(){t(this).remove(),t("tr",o).length||t(".cwx-no-entries").slideDown()})}),t("tr",o).length||t(".cwx-no-entries").slideDown()},700)},"json")})})})},loadList:function(e,i){t.post(ajaxurl,{action:"cwx_project_trash_list",id:e},function(e){i.call(this,t.trim(e))})}},n={confirmDel:!0,init:function(e){{var i={};t.extend(!0,{},i,e)}return this.each(function(){var e=t(this);$projList=t("#cwx-project-list",e),$projects=t("#cwx-project-wrap",e),$projForm=t("#cwx-project-new"),$form=t("#cwx-project-new-form"),$fltButton=t('<div id="cwx-filters-toggle" class="dashicons dashicons-search" />'),t("#cwx_project_dashwidget .hndle > span:first").append($fltButton),t("#cwx-project-filters input[type=text][list]").cwxMetaListControl(),t(".cwx-loading",$projList).slideDown(function(){var e=this;n.loadProjects(this.id,function(i){t(e).slideUp(),"message::empty"!=i?($projects.html(i),t(".cwx-project",$projects).cwxProject(),$projects.slideDown()):t(".cwx-no-projects").slideDown()})}),t(":input",$form).on("keydown",function(e){27===e.which&&(e.preventDefault(),t(".button-cancel",t(this.form)).trigger("click"))}),t(".button-cancel",$form).on("click keydown",function(e){("keydown"!==e.type||13===e.which)&&$projForm.slideUp(function(){var e=t("#cwx-project-new-form");e[0].reset(),e.show(),t(".cwx-error",$projForm).hide(),t("#cwx-new-project.button")[0].focus()})}),$form.on("submit",function(e){e.preventDefault(),n.addProject(t(this),function(e){if(e.error)t(".cwx-error",$projForm).text(e.error).slideDown();else if(e.data&&e.template){var i=t(t.trim(e.template)),n=t(".cwx-project-row",i);i.hide(),$projects.append(i),i.cwxProject(),t(".cwx-project-title span:first",n).text(e.data.title),$projForm.slideUp(function(){t(".cwx-error",$projForm).hide()}),$projects.slideDown(function(){n[0].focus(),i.slideDown(),t(".cwx-no-projects").slideUp()})}})}),t("#cwx-new-project").on("click",function(){var e=t("#cwx-project-new-form");t(".cwx-error",$projForm).hide(),e[0].reset(),e.show(function(){$projForm.slideDown(function(){t("input[name=cwx_project_title]",e).get(0).focus()})})}),$fltButton.on("click",function(e){e.stopPropagation(),t(this).toggleClass("cwx-active"),t("#cwx-project-filters").slideToggle()}),t("#cwx-apply-filters").on("click",function(){n.applyProjectFilters(e),n.applyTaskFilters(e)})})},loadProjects:function(e,i){t.post(ajaxurl,{action:"cwx_project_list",id:e},function(e){i.call(this,t.trim(e))})},addProject:function(e,i){t.post(ajaxurl,e.serialize(),function(t){i.call(this,t)},"json")},uiSetTitle:function(t,e){var i=e.title;i+="\n"+cwxProjectL10n.titleProgress.replace(/%s/,e.progress),e.t_assignee&&(i+="\n"+cwxProjectL10n.titleAssignee.replace(/%s/,e.assignee)),e.t_date_due&&(i+="\n"+cwxProjectL10n.titleDueDate.replace(/%s/,e.date_due)),t.prop("title",i)},applyProjectFilters:function(e){var i=t("#cwx-filter-projects",e).val();$msg=t(".cwx-message.cwx-no-projects",e),$rows=t(".cwx-project-row",e),$show=i?t(".cwx-project-row.cwx-"+i,e):$rows,$rows.not($show).slideUp(),$show.slideDown(),$show.length?$msg.slideUp():$msg.slideDown()},applyTaskFilters:function(e){var i=t("#cwx-filter-search",e).val(),n=t("#cwx-filter-assignee",e).val(),o=t("#cwx-filter-category",e).val(),a=t("#cwx-filter-status",e).val();t(".cwx-task",e).each(function(){var e=t(".cwx-task-row",t(this)),s=t(".cwx-task-data",t(this)),c=!1;c=""==i||t(".cwx-task-title",e).text().match(new RegExp(i,"i"))?!0:!1,c=c&&(""==n||t("input[name=cwx_task_assignee]",s).val().match(new RegExp(n,"i")))?!0:!1,c=c&&(""==o||t("input[name=cwx_task_category]",s).val().match(new RegExp(o,"i")))?!0:!1,c=c&&(""==a||t("input[name=cwx_task_status]",s).val().match(new RegExp(a,"i")))?!0:!1,c?t(this).slideDown():(s.slideUp(),t(this).slideUp().removeClass("open"))})}},o={init:function(e){{var i={};t.extend(!0,{},i,e)}return this.each(function(){var e=this.id.replace(/\D+/g,""),i=t(this),n=t("#cwx-project-form-"+e),a=t("#cwx-project-row-"+e),s=t("#cwx-project-tasks-"+e);t("#cwx-confirm-delete").detach().appendTo(t("#wpbody")),a.on("click keydown",function(n){"keydown"===n.type&&13!==n.which||t(this).hasClass("edit")||(n.preventDefault(),o.uiFolding(e,i,s,function(){}))}),a.on("click keydown","a",function(c){if(!("keydown"===c.type&&13!==c.which||t(this).hasClass("edit")))switch(c.preventDefault(),c.stopPropagation(),this.className){case"cwx-add-task":o.uiAddTask(e,n,i,s);break;case"cwx-edit-project":o.uiEdit(e,n,a);break;case"cwx-trash-project":o.uiTrash(e,n,i)}}),n.on("focusout",function(){var i=this;t(".cwx-project-row",t(this)).hasClass("edit")&&setTimeout(function(){var n=document.activeElement;"undefined"!==n&&t(n).is(":input")&&n.form.id==i.id||o._uiSave(e,t(i),a)},100)}),n.on("keydown",function(i){(13===i.which||27===i.which)&&(i.preventDefault(),i.stopPropagation(),27===i.which&&t(this).data({isDirty:!1}),o._uiSave(e,t(this),a))}),t(window).on("beforeunload",function(){return n.data("is-dirty")?cwxProjectL10n.confirmUnsavedForm:void 0})})},uiFolding:function(e,i,a,s){var c=t(".cwx-no-tasks",i);t(document).find(".cwx-task").removeClass("open"),t(document).find(".cwx-task-data").slideUp(),i.hasClass("open")?(c.slideUp(),a.slideUp(function(){i.removeClass("open"),s()})):a.children("li").length?(c.hide(),a.slideDown(function(){i.addClass("open"),s()})):(t(".cwx-loading",i).slideDown(),o.loadContents(e,function(e){t(".cwx-loading",i).slideUp(),"message::empty"==e?(a.text("").hide(),c.slideDown(function(){i.addClass("open"),s()})):(a.html(e),t("input[disabled]",a).prop("readonly",!0),t(".cwx-task",a).cwxTask(),c.slideUp(),a.slideDown(function(){i.addClass("open"),s(),n.applyTaskFilters(t("#cwx-project-main"))}))}))},uiEdit:function(e,i,n){var o=t(".cwx-project-title",n),a=t('<input type="text" name="cwx_project_title" value="" />'),s=o.text();o.wrapInner('<span style="display:none;" />'),a.val(s),a.attr("value",s),o.find("span").after(a),o.find("span").hide(),a[0].focus(),n.addClass("edit"),t(":input",i).on("change input",function(e){var i=t(this.form);("change"===e.type||"input"===e.type)&&i.data({isDirty:!0})})},uiTrash:function(e,i,a){if(!n.confirmDel)return void o._uiTrash(e,i,a);var s=t("#cwx-confirm-delete");s.fadeIn("fast"),s.find("input[type=button]:first").get(0).focus(),s.on("click","input[type=button]",function(){n.confirmDel=t("#cwx-do-not-show-again:checked").length?!1:!0,s.fadeOut("fast"),"cwx-confirm-yes"==this.id&&o._uiTrash(e,i,a)})},_uiTrash:function(e,i,n){o.trash(e,i,function(e){e.success&&n.slideUp(function(){n.remove(),t("#cwx-project-wrap").children("li").length||t(".cwx-no-projects").slideDown()})})},uiAddTask:function(e,i,n,s){n.hasClass("open")?(t(".cwx-no-tasks",n).slideUp(),a.uiAdd(e,i,n,s)):o.uiFolding(e,n,s,function(){t(".cwx-no-tasks",n).slideUp(),a.uiAdd(e,i,n,s)})},_uiSave:function(e,i,a){var s=t(".cwx-project-title",a),c=100*t(".cwx-project-progress progress",a).val();i.data("is-dirty")?o.save(e,i,function(t){s.html(t.title),n.uiSetTitle(a,{title:t.title,progress:c.toFixed(2)})}):s.html(s.find("span").html());try{t(":input, .cwx-number-control",a).remove()}catch(r){}a.removeClass("edit"),a[0].focus(),i.data({isDirty:!1})},loadContents:function(e,i){t.post(ajaxurl,{action:"cwx_task_list",id:e},function(e){i.call(this,t.trim(e))})},save:function(e,i,n){t.post(ajaxurl,i.serialize(),function(t){t.data&&n.call(this,t.data)},"json")},trash:function(e,i,n){var o=t('input[name="_nonce"]',i).val();t.post(ajaxurl,{action:"cwx_project_trash",id:e,_nonce:o},function(t){n.call(this,t)},"json")},updateProgress:function(e){var i,o,a=t("#cwx-project-row-"+e),s=t("#cwx-project-tasks-"+e),c=t(".cwx-project-progress progress",a),r=new Date,l=!1,u=0,p=0;a.length&&(t(".cwx-task",s).each(function(){u++,p+=parseInt(t(".cwx-task-row progress span",t(this)).text()),dateDue=new Date(t(".cwx-task-data input[name=cwx_task_datedue]",t(this)).val()),r>dateDue&&(l=!0)}),i=p/u,c[0].value=i/100,t("span",c).text(i.toFixed(2)),l?c.addClass("cwx-overdue"):c.removeClass("cwx-overdue"),o=t(".cwx-project-title",a).text(),n.uiSetTitle(a,{title:o,progress:i.toFixed(2)}))}},a={init:function(e){{var i={};t.extend(!0,{},i,e)}return this.each(function(){var e=this.id.replace(/\D+/g,""),i=t(this),n=t("#cwx-task-form-"+e),o=t("#cwx-task-data-form-"+e),s=t("#cwx-task-row-"+e),c=t("#cwx-task-data-"+e);t("input[type=date]",i).cwxDateControl({minDate:t(this).data("date-created")}),t("input[type=number]",i).cwxSpinControl(),t(".cwx-duration-control",i).cwxDurationControl(),t("input[type=text][list]",i).cwxMetaListControl(),s.on("click keydown",function(n){"keydown"===n.type&&13!==n.which||t(this).hasClass("edit")||(n.preventDefault(),a.uiFolding(e,i,c))}),s.on("click keydown","a",function(o){if(!("keydown"===o.type&&13!==o.which||t(this).hasClass("edit")))switch(o.preventDefault(),o.stopPropagation(),this.className){case"cwx-edit-task":a.uiEdit(e,n,s);break;case"cwx-trash-task":a.uiTrash(e,n,i)}}),n.on("focusout",function(){var i=this;t(".cwx-task-row",t(this)).hasClass("edit")&&setTimeout(function(){var n=document.activeElement;"undefined"!==n&&t(n).is(":input")&&n.form.id==i.id||a._uiSave(e,t(i),s)},100)}),n.on("keydown",function(i){(13===i.which||27===i.which)&&(i.preventDefault(),i.stopPropagation(),27===i.which&&t(this).data({isDirty:!1}),a._uiSave(e,t(this),s))}),o.on("focusout",function(){var i=this;setTimeout(function(){var n=document.activeElement;"undefined"!==n&&t(n).is(":input")&&n.form.id==i.id||a._uiUpdate(e,t(i),s)},100)}),o.on("keydown",function(i){if(13===i.which||27===i.which){var n=document.activeElement;if("undefined"!==n&&t(n).is("textarea"))return;if(i.preventDefault(),i.stopPropagation(),27===i.which)return this.reset(),t(this).data({isDirty:!1}),void t("input[name=cwx_task_progress]",t(this)).val(parseInt(100*t(".cwx-task-progress progress",s).prop("value")));a._uiUpdate(e,t(this),s)}}),t(":input",o).on("change input",function(e){var i=t(this.form);("change"===e.type||"input"===e.type)&&i.data({isDirty:!0})}),t(window).on("beforeunload",function(){return n.data("is-dirty")||o.data("is-dirty")?cwxProjectL10n.confirmUnsavedForm:void 0})})},uiFolding:function(t,e,i){i.slideToggle(function(){e.toggleClass("open")})},uiAdd:function(e,i,n,o){a.add(e,i,function(e){if(e.template){var i=t(t.trim(e.template)),n=parseInt(i.prop("id").replace(/\D/g,""));o.prepend(i),i.cwxTask(),i.slideDown(function(){o.slideDown(function(){a.uiFolding(n,i,t(".expandable",i)),a.uiEdit(n,t("#cwx-task-form-"+n),t("#cwx-task-row-"+n))})})}})},uiEdit:function(e,i,n){var o=t(".cwx-task-priority span:first",n),a=t('<input type="number" name="cwx_task_priority" min="1" max="9" step="1" size="1" value="" />'),s=parseInt(o.text()),c=t(".cwx-task-title",n),r=t('<input type="text" name="cwx_task_title" value="" />'),l=c.text();a.val(s),a.attr("value",s),o.after(a),a.cwxSpinControl(),o.hide(),c.wrapInner('<span style="display:none;" />'),r.val(l),r.attr("value",l),c.find("span").after(r),c.find("span").hide(),r[0].focus(),n.addClass("edit"),t(":input",i).on("change input",function(e){var i=t(this.form);("change"===e.type||"input"===e.type)&&i.data({isDirty:!0})})},uiTrash:function(e,i,o){if(!n.confirmDel)return void a._uiTrash(e,i,o);var s=t("#cwx-confirm-delete");s.fadeIn("fast"),s.find("input[type=button]:first").get(0).focus(),s.on("click","input[type=button]",function(){n.confirmDel=t("#cwx-do-not-show-again:checked").length?!1:!0,s.fadeOut("fast"),"cwx-confirm-yes"==this.id&&a._uiTrash(e,i,o)})},_uiTrash:function(e,i,n){a.trash(e,i,function(e){e.success&&n.slideUp(function(){var e=t(this).parent().prop("id").replace(/\D/g,""),i=t("#cwx-project-"+e),n=t(".expandable",i),o=t(".cwx-no-tasks",i);t(this).remove(),n.children("li").length||(n.hide(),o.slideDown())})})},_uiSave:function(e,i,o){var s=t(".cwx-task-priority span:first",o),c=t(".cwx-task-title",o);i.data("is-dirty")?a.save(e,i,function(t){s.text(t.priority),s.css({display:"inline-block",color:t.priority_fg,background:t.priority_bg}),c.html(t.title),t.progress=t.progress.toString(),n.uiSetTitle(o,t)}):(s.css("display","inline-block"),c.html(c.find("span").html()));try{t(":input, .cwx-number-control",o).remove()}catch(r){}o.removeClass("edit"),o[0].focus(),i.data({isDirty:!1})},_uiUpdate:function(e,i,c){i.data("is-dirty")&&(a.save(e,i,function(e){{var a=t(".cwx-task-progress progress",c),r=t(".cwx-task-assignee.cwx-form-field",i),l=new Date(e.date_due),u=new Date;e.title}a[0].value=e.progress/100,t("span",a).text(e.progress),u>l?a.addClass("cwx-overdue"):a.removeClass("cwx-overdue"),t("input[type=text][name=cwx_task_assignee]",r).length&&t("input[type=text][name=cwx_task_assignee]",r).val(e.assignee),e.progress=e.progress.toString(),n.uiSetTitle(c,e),o.updateProgress(e.parent_id),e.meta&&(e.meta.status&&"created"==e.meta.status.status&&s.uiAdd("cwx-statuses",e.meta.status.title),e.meta.category&&"created"==e.meta.category.status&&s.uiAdd("cwx-categories",e.meta.category.title))}),i.data({isDirty:!1}))},add:function(e,i,n){var o=t('input[name="_nonce"]',i).val();t.post(ajaxurl,{action:"cwx_task_add",project_id:e,_nonce:o},function(t){n.call(this,t)},"json")},save:function(e,i,n){t.post(ajaxurl,i.serialize(),function(t){t.data&&n.call(this,t.data)},"json")},trash:function(e,i,n){var o=t('input[name="_nonce"]',i).val();t.post(ajaxurl,{action:"cwx_task_trash",id:e,_nonce:o},function(t){n.call(this,t)},"json")}},s={isNative:!!("list"in document.createElement("input"))&&!(!document.createElement("datalist")||!window.HTMLDataListElement),init:function(){{var e={};t.extend(!0,{},e,arguments)}return this.each(function(){var e=t(this).prop("list");s.isNative?t("select",t(e)).children().unwrap():t(this).autocomplete({source:s._getSource(t(e))})})},uiAdd:function(e,i){var n=t("datalist#"+e);s.isNative?t("datalist#"+e).append('<option value="'+i+'" />'):(t("select",n).append('<option value="'+i+'" />'),n.autocomplete("option","source",s._getSource(n)))},uiRemove:function(e,i){var n=t("datalist#"+e);s.isNative?t("datalist#"+e).find('option[value="'+i+'"]').remove():(t("select",n).find('option[value="'+i+'"]').remove(),n.autocomplete("option","source",s._getSource(n)))},add:function(e,i,n,o){var a={action:"cwx_project_add_meta",cwx_meta_type_n:i,cwx_meta_title_n:e,_nonce:n};t.post(ajaxurl,a,function(t){o.call(this,t)},"json")},_getSource:function(t){return t.find("option").map(function(){return this.value}).get()}},c={timed:!1,init:function(){{var e={};t.extend(!0,{},e,arguments)}return this.each(function(){var e=t(".cwx-tab-container",t(this)),i=t(".cwx-tab-strip",e),n=t(".cwx-tab-sheet",t(this)),o=t(".cwx-tab-scroller",e);o.data({absWidth:o.width()+12}),i.html(i.html().replace(/<\/li>\s+<li/g,"</li><li")),setTimeout(function(){e.removeAttr("style"),i.removeAttr("style"),c.recalcScrollers(e),i.filter(":first").trigger("click").delay(1e3).focus()},500),t(".cwx-tab",i).on("click keydown focus",function(e){if("keydown"!==e.type||13===e.which)if(t(".cwx-tab",i).removeClass("cwx-tab-active"),n.removeClass("cwx-sheet-active"),t(this).addClass("cwx-tab-active"),t("#"+this.id.replace(/\-tab\-/,"-sheet-")).addClass("cwx-sheet-active"),"focus"!==e.type)c.scrollTabIntoView(t(this));else{c.setScrollersStatus(i.parent());var o=t("#"+this.id.replace(/\-tab\-/,"-sheet-"));o.find("a:first, :input:not([type=hidden]):first").get(0).focus()}}),t(".cwx-tab-scroll-left",o).on("click keydown",function(e){"keydown"===e.type&&13!==e.which||!t(this).hasClass("cwx-enabled")||t(".cwx-tab.cwx-tab-active",i).prev().trigger("click")}),t(".cwx-tab-scroll-right",o).on("click keydown",function(e){"keydown"===e.type&&13!==e.which||!t(this).hasClass("cwx-enabled")||t(".cwx-tab.cwx-tab-active",i).next().trigger("click")}),t(window).on("resize",function(){c.timed||(timed=setTimeout(function(){c.recalcScrollers(e)},1e3))})})},recalcScrollers:function(e){var i=t(".cwx-tab-bar",e),n=t(".cwx-tab-strip",i),o=t(".cwx-tab-scroller",e);clearTimeout(c.timed),c.timed=!1,n.width()>e.width()?(o.show(),i.width(e.width()-parseInt(o.data("abs-width"))),isRtl&&n.css({right:"auto"}),setTimeout(function(){t(".cwx-tab-active",i).trigger("click")},200)):(o.hide(),i.width(e.width()),n.css(isRtl?{right:"0px",left:"auto"}:{left:"0px"}))},scrollTabIntoView:function(t){var e=t.closest(".cwx-tab-bar"),i=t.parent().position().left,n=Math.abs(i)+e.width(),o=t.position().left,a=o+t.outerWidth(),s=0;s=0>i+o?-o:a>n?e.width()-a:i,t.parent().animate({left:s},function(){t[0].focus(),c.setScrollersStatus(e)})},setScrollersStatus:function(e){var i=e.parent();t(".cwx-tab-active",e).index()>0?t(".cwx-tab-scroll-left",i).addClass("cwx-enabled"):t(".cwx-tab-scroll-left",i).removeClass("cwx-enabled"),t(".cwx-tab-active",e).index()<t(".cwx-tab",e).length-1?t(".cwx-tab-scroll-right",i).addClass("cwx-enabled"):t(".cwx-tab-scroll-right",i).removeClass("cwx-enabled")}};t.fn.cwxSpinControl=function(){var e=!1,i={unit:""},n=t.extend(!0,{},i,arguments);return this.each(function(){function i(t){var i=window.setInterval(function(){return e===!1?void window.clearInterval(i):void t.trigger({type:"changenum",which:e})},100)}var o=!1,a=!1,s=!1,c=n.unit,r=t(this),l=t('<input type="text">'),u=t('<span class="cwx-number-unit" />'),p=t('<div class="cwx-number-control cwx-control" />'),d=t('<span class="cwx-spin-control"><span class="dashicons dashicons-arrow-up cwx-spin-button" /><span class="dashicons dashicons-arrow-down cwx-spin-button" /></span>');r.is("[min]")&&(o=parseInt(r.prop("min"))),r.is("[max]")&&(a=parseInt(r.prop("max"))),r.is("[step]")&&(s=parseInt(r.prop("step"))),r.data("unit")&&(c=r.data("unit")),l.val(r.val()),l.prop("value",r.val()),l.prop("name",r.prop("name")),l.data({min:o,max:a,step:s}),r.is("[size]")&&l.prop("size",r.prop("size")),p.append(l),c&&p.append(u.text(c)),p.append(d),r.is("[title]")&&p.prop("title",r.prop("title")),r.replaceWith(p),p.on("click",function(){l[0].focus()}),t(".dashicons-arrow-up",p).on("mousedown",function(){e=38,i(l)}),t(".dashicons-arrow-down",p).on("mousedown",function(){e=40,i(l)}),t(".cwx-spin-button",p).on("mouseup",function(){e=!1}),l.on("keydown changenum",function(e){if(38===e.which||40===e.which){e.preventDefault(),e.stopPropagation();var i=parseInt(t(this).val());if(38===e.which){if(i++,i>parseInt(t(this).data("max")))return}else if(40===e.which&&(i--,i<parseInt(t(this).data("min"))))return;t(this).val(i),this.focus(),t(this.form).data({isDirty:!0})}}),l.on("focus blur",function(e){"focus"==e.type?t(this).parent().addClass("cwx-input-focus"):t(this).parent().removeClass("cwx-input-focus")})})},t.fn.cwxDurationControl=function(){var e=!1,i={autotrans:!0},n=t.extend(!0,{},i,arguments);return this.each(function(){function i(){var i=window.setInterval(function(){return e===!1?void window.clearInterval(i):void t(c).trigger({type:"changenum",which:e,target:c})},100)}function o(t,e){var i=parseInt(t.data("min")),n=parseInt(t.data("max")),a=t.prev().prev("input"),s=parseInt(a.data("min")),c=parseInt(a.data("max")),r=parseInt(a.val());if(a.length){if(e>n)return c>r?(a.val(r+1),i):n;if(i>e)return r>s?(a.val(r-1),n):i;a.val(o(a,a.val))}else{if(e>n)return n;if(i>e)return i}return e}var a=t(this),s=t('<span class="cwx-spin-control"><span class="dashicons dashicons-arrow-up cwx-spin-button" /><span class="dashicons dashicons-arrow-down cwx-spin-button" /></span>'),c=t(":input",a).get(2);a.wrapInner('<div class="cwx-duration-input" />'),a.append(s),s.on("click",function(){c.focus()}),t(".dashicons-arrow-up",a).on("mousedown",function(){e=38,i()}),t(".dashicons-arrow-down",a).on("mousedown",function(){e=40,i()}),t(".cwx-spin-button",a).on("mouseup",function(){e=!1}),a.on("focusin blur",":input",function(e){"focusin"==e.type?(c=this,t(this).parent().addClass("cwx-input-focus")):t(this).parent().removeClass("cwx-input-focus")}),a.on("keydown changenum",":input",function(e){if(38===e.which||40===e.which){e.preventDefault(),e.stopPropagation();var i=parseInt(t(this).val());if(38===e.which){if(i++,i>parseInt(t(this).data("max"))){if(!n.autotrans)return;i=o(t(this),i)}}else if(40===e.which&&(i--,i<parseInt(t(this).data("min")))){if(!n.autotrans)return;i=o(t(this),i)}t(this).val(i),this.focus(),t(this.form).data({isDirty:!0})}})})},t.fn.cwxDateControl=function(){var e={gotoCurrent:!0,changeMonth:!0,changeYear:!0,autoSize:!0,showAnim:"fadeIn",showOtherMonths:!0,selectOtherMonths:!1,showButtonPanel:!0},i=t.extend(!0,{},e,jQUIDatepickerL10n,arguments,{showOn:"focus",prevText:"",nextText:"",isRTL:isRtl?!0:!1});return this.each(function(){var e=this,n=t('<div class="cwx-date-control cwx-control" />'),o=t('<span class="dashicons dashicons-calendar" />'),a=new Date(i.minDate?i.minDate:t(this).data("min-date"));t(this).prop("type","text").datepicker(t.extend(i,{minDate:a,onClose:function(){e.focus()}})),t(this).wrap(n),t(this).after(o),t(this).prop("readonly")&&t(this).parent().addClass("cwx-readonly"),t(this).on("focus blur",function(e){"focus"==e.type?t(this).parent().addClass("cwx-input-focus"):t(this).parent().removeClass("cwx-input-focus")}),o.on("click",function(){e.focus()})})},t.fn.cwxColorControl=function(){var e={},i=t.extend(!0,{},e,arguments);return this.each(function(){t(this).wpColorPicker(i),t("a.wp-color-result").on("click",function(){if(t(this).hasClass("wp-picker-open")){var e=t(".wp-picker-holder",t(this).parent()),i=e.offset(),n=t(this).offset(),o=n.top+t(this).outerHeight(),a=t("#wpbody-content").innerHeight();t("a.wp-picker-open").not(t(this)).trigger("click"),o+e.outerHeight()>a?(i.top=n.top-6-e.outerHeight(),e.offset(i)):(i.top=o,e.offset(i))}})})},t.fn.cwxMetaListControl=function(){return s.init.apply(this,arguments)},t.fn.cwxTabbedControl=function(){return c.init.apply(this,arguments)},t.fn.cwxProjectMetabox=function(){{var e={};t.extend(!0,{},e,arguments)}return this.each(function(){var e=t(this);t("input[type=date]",e).cwxDateControl({minDate:t(this).data("date-created")}),t("input[type=number]",e).cwxSpinControl(),t(".cwx-duration-control",e).cwxDurationControl(),t("input[type=text][list]",e).cwxMetaListControl(),t("input[disabled]",e).prop("readonly",!0),t("#cwx-task-project").on("change",function(){"new"==t(this).val()?t("#cwx-task-new-project").slideDown(function(){t("input[name=cwx_task_new_project]")[0].focus()}):t("#cwx-task-new-project").slideUp(function(){this.focus()}),t(this).val()?t("#cwx-selfassing-option").slideDown():t("#cwx-selfassing-option").slideUp()})})},t.fn.cwxProjectConfig=function(){return e.init.apply(this,arguments)},t.fn.cwxProjectTrash=function(){return i.init.apply(this,arguments)},t.fn.cwxProjectWidget=function(){return n.init.apply(this,arguments)},t.fn.cwxProject=function(){return o.init.apply(this,arguments)},t.fn.cwxTask=function(){return a.init.apply(this,arguments)},t(document).ready(function(){t("#cwx-project-main").cwxProjectWidget(),t("#cwx-project-trash").cwxProjectTrash(),t("#cwx-project-config").cwxProjectConfig(),t("#cwx-project-mbx").cwxProjectMetabox(),t("#cwx-project-admin-help").cwxTabbedControl()})}(jQuery);
